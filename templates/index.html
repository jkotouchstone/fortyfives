<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Forty‑Fives Game</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <style>
    /* Basic styling – feel free to adjust later */
    body {
      font-family: sans-serif;
      background: #f5f5f5;
      margin: 0;
      padding: 20px;
      text-align: center;
    }
    .container {
      max-width: 800px;
      margin: auto;
      background: #fff;
      padding: 20px;
      border-radius: 8px;
    }
    .section { margin: 20px 0; }
    .hidden { display: none; }
    .cards-container {
      display: flex;
      justify-content: center;
      flex-wrap: wrap;
    }
    .card {
      display: inline-block;
      width: 60px;
      height: 90px;
      border: 1px solid #333;
      border-radius: 5px;
      line-height: 90px;
      margin: 5px;
      cursor: pointer;
      user-select: none;
    }
    .card.selected { background: #ffeb3b; }
    button {
      padding: 10px 15px;
      margin: 5px;
      font-size: 16px;
      cursor: pointer;
    }
  </style>
</head>
<body>
  <div class="container">
    <!-- Bidding Section -->
    <div id="bidding-section" class="section">
      <h2>Bidding Phase</h2>
      <div>Your Hand:</div>
      <div id="player-hand-bidding" class="cards-container"></div>
      <div>
        <button onclick="placeBid(0)">Pass</button>
        <button onclick="placeBid(15)">Bid 15</button>
        <button onclick="placeBid(20)">Bid 20</button>
        <button onclick="placeBid(25)">Bid 25</button>
        <button onclick="placeBid(30)">Bid 30</button>
      </div>
      <div id="bidding-message"></div>
    </div>
    
    <!-- Kitty Phase (only if you win the bid) -->
    <div id="kitty-section" class="section hidden">
      <h2>Kitty Phase</h2>
      <div>Your Combined Hand (Your 5 cards + Kitty):</div>
      <div id="combined-hand" class="cards-container"></div>
      <div id="kitty-instructions">
        Select up to 5 cards to keep from your 8‑card hand. You will be issued the remaining cards to bring your hand to 5 cards.
      </div>
      <button onclick="confirmKittySelection()">Confirm Selection</button>
    </div>
    
    <!-- Trick Play Section -->
    <div id="trick-section" class="section hidden">
      <h2>Trick Play</h2>
      <div id="trick-info"></div>
      <div>Your Hand:</div>
      <div id="player-hand-trick" class="cards-container"></div>
      <div>Trick Area:</div>
      <div id="trick-area" class="cards-container"></div>
    </div>
    
    <!-- Result Section -->
    <div id="result-section" class="section hidden">
      <h2>Result</h2>
      <div id="result-message"></div>
      <button onclick="resetGame()">Play Again</button>
    </div>
  </div>
  
  <script>
    /***** Game State Variables *****/
    let gamePhase = "bidding";  // phases: "bidding", "kitty", "trick", "finished"
    let deck = [];
    let playerHand = [];
    let competitorHand = [];
    let kitty = [];
    let playerBid = 0;
    let competitorBid = 0;
    let bidWinner = null; // "player" or "competitor"
    let playerTricks = 0;
    let competitorTricks = 0;
    let trickCards = []; // Array of objects: { card, player }
    
    const suits = ['♠', '♥', '♦', '♣'];
    const ranks = ['2','3','4','5','6','7','8','9','10','J','Q','K','A'];
    
    /***** Utility Functions *****/
    function createDeck() {
      let newDeck = [];
      for (let suit of suits) {
        for (let rank of ranks) {
          let value = (rank === 'A') ? 14 :
                      (rank === 'K') ? 13 :
                      (rank === 'Q') ? 12 :
                      (rank === 'J') ? 11 : parseInt(rank);
          newDeck.push({ suit, rank, value });
        }
      }
      return newDeck;
    }
    function shuffle(arr) {
      for (let i = arr.length - 1; i > 0; i--) {
        let j = Math.floor(Math.random() * (i + 1));
        [arr[i], arr[j]] = [arr[j], arr[i]];
      }
    }
    
    /***** Initial Deal (on page load) *****/
    function dealCards() {
      deck = createDeck();
      shuffle(deck);
      // Deal 5 cards to you and 5 to competitor; kitty gets 3 cards.
      playerHand = deck.splice(0, 5);
      competitorHand = deck.splice(0, 5);
      kitty = deck.splice(0, 3);
      updateBiddingUI();
    }
    
    // Display player's hand during bidding.
    function updateBiddingUI() {
      const container = document.getElementById('player-hand-bidding');
      container.innerHTML = "";
      playerHand.forEach(card => {
        const div = document.createElement('div');
        div.className = 'card';
        div.textContent = card.rank + card.suit;
        container.appendChild(div);
      });
    }
    
    /***** Bidding Phase *****/
    // When you click a bid button (bid of 0 means Pass)
    function placeBid(bid) {
      playerBid = bid;
      // Simulate competitor bid: for simplicity, 50% chance to pass (bid 0) or bid randomly from 15,20,25,30.
      competitorBid = (Math.random() < 0.5) ? 0 : [15, 20, 25, 30][Math.floor(Math.random() * 4)];
      let message = "";
      // Determine bid winner. (If both pass, competitor wins by default.)
      if (playerBid === 0 && competitorBid === 0) {
        bidWinner = "competitor";
        message = "Both passed. Competitor wins the bid.";
      } else if (playerBid >= competitorBid) {
        bidWinner = "player";
        message = "You win the bid (" + playerBid + " vs. " + competitorBid + ").";
      } else {
        bidWinner = "competitor";
        message = "Competitor wins the bid (" + competitorBid + " vs. your bid " + playerBid + ").";
      }
      document.getElementById('bidding-message').textContent = message;
      // Proceed after a short pause.
      setTimeout(() => {
        if (bidWinner === "player") {
          gamePhase = "kitty";
          updateKittyPhase();
        } else {
          // Competitor wins: add kitty to competitor's hand and auto-discard extras.
          competitorHand = competitorHand.concat(kitty);
          while (competitorHand.length > 5) {
            competitorHand.splice(Math.floor(Math.random() * competitorHand.length), 1);
          }
          startTrickPlay();
        }
      }, 1500);
    }
    
    /***** Kitty Phase (Player wins bid) *****/
    function updateKittyPhase() {
      document.getElementById('bidding-section').classList.add('hidden');
      document.getElementById('kitty-section').classList.remove('hidden');
      // Combine your original hand and the kitty (total 8 cards).
      const combined = playerHand.concat(kitty);
      const container = document.getElementById('combined-hand');
      container.innerHTML = "";
      combined.forEach((card, index) => {
        const div = document.createElement('div');
        div.className = 'card';
        div.textContent = card.rank + card.suit;
        div.dataset.index = index;
        div.onclick = () => {
          // Toggle selection. (Allow up to 5 selections.)
          if (div.classList.contains('selected')) {
            div.classList.remove('selected');
          } else {
            const selected = container.querySelectorAll('.selected');
            if (selected.length < 5) {
              div.classList.add('selected');
            }
          }
        };
        container.appendChild(div);
      });
    }
    
    // Confirm your selection from the combined hand.
    function confirmKittySelection() {
      const container = document.getElementById('combined-hand');
      const selectedDivs = container.querySelectorAll('.selected');
      let selectedCards = [];
      const combined = playerHand.concat(kitty);
      selectedDivs.forEach(div => {
        selectedCards.push(combined[parseInt(div.dataset.index)]);
      });
      if (selectedCards.length > 5) {
        alert("You can keep at most 5 cards.");
        return;
      }
      const numToDraw = 5 - selectedCards.length;
      for (let i = 0; i < numToDraw; i++) {
        if (deck.length > 0) {
          selectedCards.push(deck.pop());
        }
      }
      playerHand = selectedCards;
      startTrickPlay();
    }
    
    /***** Trick Play Phase *****/
    function startTrickPlay() {
      gamePhase = "trick";
      document.getElementById('bidding-section').classList.add('hidden');
      document.getElementById('kitty-section').classList.add('hidden');
      document.getElementById('trick-section').classList.remove('hidden');
      updateTrickUI();
    }
    
    // Update the trick play UI – show your current hand and clear the trick area.
    function updateTrickUI() {
      const handDiv = document.getElementById('player-hand-trick');
      handDiv.innerHTML = "";
      playerHand.forEach((card, index) => {
        const div = document.createElement('div');
        div.className = 'card';
        div.textContent = card.rank + card.suit;
        div.onclick = () => {
          if (gamePhase === "trick") playPlayerCard(index);
        };
        handDiv.appendChild(div);
      });
      document.getElementById('trick-area').innerHTML = "";
      document.getElementById('trick-info').textContent = "Trick " + (6 - playerHand.length) + " of 5";
    }
    
    // When you play a card during trick play.
    function playPlayerCard(index) {
      if (gamePhase !== "trick") return;
      const card = playerHand.splice(index, 1)[0];
      trickCards.push({ card: card, player: "player" });
      updateTrickArea();
      setTimeout(competitorPlayCard, 1000);
    }
    
    // Competitor plays a card automatically.
    function competitorPlayCard() {
      if (competitorHand.length === 0) return;
      const idx = Math.floor(Math.random() * competitorHand.length);
      const card = competitorHand.splice(idx, 1)[0];
      trickCards.push({ card: card, player: "competitor" });
      updateTrickArea();
      setTimeout(evaluateTrick, 1000);
    }
    
    // Update the trick area display.
    function updateTrickArea() {
      const trickDiv = document.getElementById('trick-area');
      trickDiv.innerHTML = "";
      trickCards.forEach(entry => {
        const div = document.createElement('div');
        div.className = 'card';
        div.textContent = entry.card.rank + entry.card.suit;
        trickDiv.appendChild(div);
      });
    }
    
    // Evaluate the trick – here, simply the highest card value wins.
    function evaluateTrick() {
      if (trickCards.length < 2) return;
      let winning = trickCards[0];
      trickCards.forEach(entry => {
        if (entry.card.value > winning.card.value) {
          winning = entry;
        }
      });
      if (winning.player === "player") {
        playerTricks++;
      } else {
        competitorTricks++;
      }
      trickCards = [];
      if (playerHand.length === 0 && competitorHand.length === 0) {
        endHand();
      } else {
        updateTrickUI();
      }
    }
    
    function endHand() {
      gamePhase = "finished";
      document.getElementById('trick-section').classList.add('hidden');
      document.getElementById('result-section').classList.remove('hidden');
      const result = "Tricks won – You: " + playerTricks + " | Competitor: " + competitorTricks;
      document.getElementById('result-message').textContent = result;
    }
    
    function resetGame() {
      gamePhase = "bidding";
      playerTricks = 0;
      competitorTricks = 0;
      trickCards = [];
      document.getElementById('bidding-message').textContent = "";
      document.getElementById('result-section').classList.add('hidden');
      document.getElementById('bidding-section').classList.remove('hidden');
      dealCards();
    }
    
    // Initialize the game when the page loads.
    window.onload = dealCards;
  </script>
</body>
</html>
