<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Forty-Fives â€“ Enhanced Game UI</title>
  <style>
    /* Background: Green felt table */
    body {
      margin: 0;
      padding: 0;
      background-color: #006400;
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      color: #fff;
      overflow: hidden;
    }
    #table {
      position: relative;
      width: 100%;
      height: 100vh;
      display: grid;
      grid-template-areas:
        "dealer dealer dealer"
        "score score score"
        "comp comp comp"
        "left center right"
        "player player player";
      grid-template-rows: auto auto 150px 1fr 200px;
      grid-template-columns: 1fr 2fr 1fr;
      padding: 20px;
      box-sizing: border-box;
    }
    /* Dealer Indicator */
    #dealerIndicator {
      grid-area: dealer;
      font-size: 1.5em;
      text-align: center;
      margin-bottom: 10px;
    }
    /* Scoreboard */
    #scoreboard {
      grid-area: score;
      background: rgba(0, 0, 0, 0.7);
      padding: 10px 15px;
      border-radius: 8px;
      font-size: 1.1em;
    }
    /* Computer's hand */
    #compArea {
      grid-area: comp;
      display: flex;
      justify-content: center;
      align-items: center;
      gap: 10px;
    }
    /* Center trick area */
    #centerArea {
      grid-area: center;
      display: flex;
      justify-content: center;
      align-items: center;
      position: relative;
      border: 3px dashed rgba(255,255,255,0.7);
      border-radius: 12px;
      background: rgba(0, 0, 0, 0.5);
    }
    /* Player's hand */
    #playerArea {
      grid-area: player;
      display: flex;
      justify-content: center;
      align-items: center;
      gap: 10px;
    }
    /* Bidding Controls */
    #biddingControls {
      position: absolute;
      bottom: 20px;
      left: 50%;
      transform: translateX(-50%);
      background: rgba(0, 0, 0, 0.8);
      padding: 10px;
      border-radius: 8px;
      display: flex;
      gap: 10px;
    }
    /* Card images */
    .card {
      width: 80px;
      cursor: pointer;
      border-radius: 5px;
      transition: transform 0.2s;
    }
    .card:hover {
      transform: scale(1.1);
    }
    /* Buttons */
    button {
      padding: 8px 12px;
      background: #333;
      color: #fff;
      border: none;
      border-radius: 5px;
      cursor: pointer;
    }
    button:hover {
      background: #444;
    }
  </style>
</head>
<body>
<div id="table">
  <div id="dealerIndicator">Loading dealer info...</div>
  <div id="scoreboard">
    <div id="scoreInfo">Scores Loading...</div>
  </div>
  <div id="compArea">
    <!-- Computer's hand (show card backs) -->
    <div id="compHand"></div>
  </div>
  <div id="centerArea">
    <!-- Current trick area -->
    <span id="trickPrompt">No trick yet</span>
  </div>
  <div id="playerArea">
    <!-- Player's hand -->
    <div id="playerHand"></div>
  </div>
  <div id="biddingControls">
    <!-- Bidding buttons -->
    <button id="bidPassBtn" onclick="userBid(0)">Pass</button>
    <button id="bid15Btn" onclick="userBid(15)">Bid 15</button>
    <button id="bid20Btn" style="display: none;" onclick="userBid(20)">Bid 20</button>
    <!-- Additional buttons will appear dynamically based on bidding phase -->
  </div>
</div>

<script>
  function log(msg) {
    const logDiv = document.getElementById("scoreboard");
    logDiv.innerHTML += `<p>${msg}</p>`;
  }

  // Fetch state and update UI
  function showState() {
    fetch('/show_state')
      .then(res => res.json())
      .then(data => {
        document.getElementById("scoreInfo").textContent =
          `You: ${data.total_your} | Computer: ${data.total_comp}`;

        // Update dealer indicator
        const dealerIndicator = document.getElementById("dealerIndicator");
        const dealerName = data.leading_player === 0 ? "Player" : "Computer";
        dealerIndicator.textContent = `Dealer: ${dealerName}`;

        // Update hand views
        updatePlayerHand(data.your_cards);
        updateComputerHand(data.computer_count);
      });
  }

  function updatePlayerHand(cards) {
    const playerArea = document.getElementById("playerHand");
    playerArea.innerHTML = "";
    cards.forEach(card => {
      const img = document.createElement("img");
      img.src = card.img;
      img.className = "card";
      playerArea.appendChild(img);
    });
  }

  function updateComputerHand(count) {
    const compArea = document.getElementById("compHand");
    compArea.innerHTML = "";
    for (let i = 0; i < count; i++) {
      const img = document.createElement("img");
      img.src = "/static/card_back.png";  // Placeholder for card back image
      img.className = "card";
      compArea.appendChild(img);
    }
  }

  function userBid(bidVal) {
    fetch('/user_bid', {
      method: "POST",
      headers: {"Content-Type": "application/json"},
      body: JSON.stringify({bid_val: bidVal})
    })
      .then(res => res.json())
      .then(data => {
        log(data.message);
        showState();
      });
  }

  window.onload = showState;
</script>
</body>
</html>
